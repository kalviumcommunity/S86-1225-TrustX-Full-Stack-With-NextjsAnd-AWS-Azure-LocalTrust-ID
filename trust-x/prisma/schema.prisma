generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  role      String    @default("USER")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  projects  Project[]
  orders    Order[]
  payments  Payment[]
  files     File[]

  // Indexes for frequently queried fields
  @@index([email])
  @@index([role])
  @@index([createdAt])
}

model Project {
  id        Int       @id @default(autoincrement())
  title     String
  status    String    @default("active")

  userId    Int
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  tasks     Task[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Indexes for frequently queried fields
  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model Task {
  id        Int       @id @default(autoincrement())
  title     String
  status    String    @default("pending")
  priority  String    @default("medium")

  projectId Int
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Indexes for frequently queried fields
  @@index([projectId])
  @@index([status])
  @@index([priority])
}

// Order model for transaction examples
model Order {
  id        Int       @id @default(autoincrement())
  orderNumber String  @unique
  userId    Int
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  status    String    @default("pending")
  totalAmount Float
  
  items     OrderItem[]
  payments  Payment[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Indexes for frequently queried fields
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@index([orderNumber])
}

model OrderItem {
  id        Int       @id @default(autoincrement())
  orderId   Int
  order     Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  productId Int
  product   Product   @relation(fields: [productId], references: [id])
  
  quantity  Int
  price     Float

  createdAt DateTime  @default(now())

  // Indexes for transaction queries
  @@index([orderId])
  @@index([productId])
}

model Product {
  id        Int       @id @default(autoincrement())
  name      String
  description String?
  sku       String    @unique
  price     Float
  stock     Int       @default(0)

  orderItems OrderItem[]
  inventory  Inventory?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Indexes for frequently queried fields
  @@index([sku])
  @@index([price])
}

model Inventory {
  id        Int       @id @default(autoincrement())
  productId Int       @unique
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  warehouseLocation String
  lastRestockDate DateTime
  reorderLevel Int

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Index for warehouse location queries
  @@index([productId])
  @@index([warehouseLocation])
}

model Payment {
  id        Int       @id @default(autoincrement())
  orderId   Int
  order     Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  userId    Int
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  amount    Float
  status    String    @default("pending")
  method    String
  transactionId String @unique

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Indexes for frequently queried fields
  @@index([orderId])
  @@index([userId])
  @@index([status])
  @@index([transactionId])
}

model File {
  id        Int       @id @default(autoincrement())
  name      String
  url       String
  size      Int?
  type      String
  userId    Int?
  user      User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Indexes for frequently queried fields
  @@index([userId])
  @@index([createdAt])
}
